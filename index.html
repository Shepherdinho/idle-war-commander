<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Idle War Commander - Core</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #121212;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  #gameContainer {
    display: flex;
    height: 100vh;
    width: 100vw;
  }
  #gameCanvas {
    background: #1b1b1b;
    flex: 3;
    display: block;
  }
  #uiPanel {
    flex: 1;
    background: #222;
    padding: 15px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  h1, h2 {
    margin: 0 0 10px 0;
  }
  button {
    width: 100%;
    margin: 6px 0;
    padding: 10px;
    font-size: 1rem;
    background: #3a3a3a;
    border: none;
    color: #eee;
    cursor: pointer;
    border-radius: 6px;
    transition: background 0.3s;
  }
  button:hover:not(:disabled) {
    background: #4caf50;
  }
  button:disabled {
    background: #555;
    cursor: not-allowed;
  }
  .stat {
    margin-bottom: 8px;
    font-size: 1.1rem;
  }
  #log {
    margin-top: 20px;
    height: 160px;
    overflow-y: auto;
    background: #111;
    padding: 8px;
    border-radius: 6px;
    font-size: 0.9rem;
    line-height: 1.2;
  }
</style>
</head>
<body>
<div id="gameContainer">
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <div id="uiPanel">
    <h1>Idle War Commander</h1>
    <div class="stat">Soldiers: <span id="soldiersCount">0</span></div>
    <div class="stat">Gold: <span id="goldCount">0</span></div>
    <div class="stat">Enemy Health: <span id="enemyHealth">100</span></div>
    <h2>Actions</h2>
    <button id="attackBtn" disabled>Attack Enemy (-5 Soldiers)</button>
    <button id="recruitBtn">Recruit Soldiers (+1 per 3 sec)</button>
    <h2>Upgrades</h2>
    <button id="upgradeRecruitBtn">Upgrade Recruitment (Cost: 50 Soldiers)</button>
    <button id="upgradeAttackBtn">Upgrade Attack Power (Cost: 75 Soldiers)</button>
    <button id="upgradeGoldBtn">Upgrade Gold Gain (Cost: 30 Gold)</button>
    <h2>Item Shop</h2>
    <button id="buyShieldBtn">Buy Shield (50 Gold)</button>
    <button id="buyMedicBtn">Buy Medic Tent (100 Gold)</button>
    <div id="log"></div>
  </div>
</div>

<script>
// Canvas setup
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const width = canvas.width;
const height = canvas.height;

// Game State
let soldiers = 0;
let gold = 0;
let enemyHealth = 100;
let maxEnemyHealth = 100;

let recruitRate = 1; // soldiers per interval
let recruitInterval = 3000; // 3 seconds

let attackPower = 10;
let goldGain = 1;

let shieldActive = false;
let medicActive = false;

let upgradeRecruitCost = 50;
let upgradeAttackCost = 75;
let upgradeGoldCost = 30;

// UI Elements
const soldiersCount = document.getElementById('soldiersCount');
const goldCount = document.getElementById('goldCount');
const enemyHealthEl = document.getElementById('enemyHealth');

const attackBtn = document.getElementById('attackBtn');
const recruitBtn = document.getElementById('recruitBtn');
const upgradeRecruitBtn = document.getElementById('upgradeRecruitBtn');
const upgradeAttackBtn = document.getElementById('upgradeAttackBtn');
const upgradeGoldBtn = document.getElementById('upgradeGoldBtn');
const buyShieldBtn = document.getElementById('buyShieldBtn');
const buyMedicBtn = document.getElementById('buyMedicBtn');
const logEl = document.getElementById('log');

// Timing control
let lastRecruitTime = 0;
let lastEnemyAttackTime = 0;
const enemyAttackInterval = 7000; // Enemy attacks roughly every 7 sec

// Animation Frames for soldiers and enemies
const soldierFrames = [];
const enemyFrames = [];
let soldierFrameIndex = 0;
let enemyFrameIndex = 0;

// Load images for animations
function loadImage(src) {
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => resolve(img);
    img.src = src;
  });
}

async function loadAssets() {
  // You can replace these URLs with your own sprites or sprite sheets
  // For now we load 4 frames each for soldiers and enemies for simple animation
  soldierFrames.push(await loadImage('https://i.imgur.com/zG7p3TG.png')); // soldier1
  soldierFrames.push(await loadImage('https://i.imgur.com/ooNxMPh.png')); // soldier2
  soldierFrames.push(await loadImage('https://i.imgur.com/fjFczJF.png')); // soldier3
  soldierFrames.push(await loadImage('https://i.imgur.com/txCZ0no.png')); // soldier4

  enemyFrames.push(await loadImage('https://i.imgur.com/dGkNaPc.png')); // enemy1
  enemyFrames.push(await loadImage('https://i.imgur.com/cvA4L4P.png')); // enemy2
  enemyFrames.push(await loadImage('https://i.imgur.com/t2V0zHf.png')); // enemy3
  enemyFrames.push(await loadImage('https://i.imgur.com/3Uy1cRz.png')); // enemy4
}

// Game Logs
function log(message) {
  const p = document.createElement('p');
  p.textContent = message;
  logEl.prepend(p);
  if (logEl.childNodes.length > 50) {
    logEl.removeChild(logEl.lastChild);
  }
}

// Update UI elements
function updateUI() {
  soldiersCount.textContent = soldiers;
  goldCount.textContent = gold;
  enemyHealthEl.textContent = enemyHealth;
  attackBtn.disabled = soldiers < 5 || enemyHealth <= 0;
  upgradeRecruitBtn.disabled = soldiers < upgradeRecruitCost;
  upgradeAttackBtn.disabled = soldiers < upgradeAttackCost;
  upgradeGoldBtn.disabled = gold < upgradeGoldCost;
  buyShieldBtn.disabled = gold < 50 || shieldActive;
  buyMedicBtn.disabled = gold < 100 || medicActive;
}

// Recruitment
function recruitSoldiers() {
  soldiers += recruitRate;
  log(`Recruited ${recruitRate} soldier(s). Total: ${soldiers}`);
}

// Attack Enemy
function attackEnemy() {
  if (soldiers < 5 || enemyHealth <= 0) return;
  soldiers -= 5;
  enemyHealth -= attackPower;

  log(`Attacked enemy for ${attackPower} damage. Enemy health: ${Math.max(enemyHealth, 0)}`);

  if (enemyHealth <= 0) {
    enemyHealth = 0;
    soldiers += 50;
    gold += 10 * goldGain;
    log(`Enemy defeated! Gained 50 soldiers and ${10 * goldGain} gold.`);
    enemyHealth = maxEnemyHealth;
  }

  updateUI();
}

// Enemy Attacks Soldiers
function enemyAttack() {
  if (soldiers <= 0) {
    log('Enemy attacks but you have no soldiers left!');
    return;
  }

  if (shieldActive) {
    shieldActive = false;
    log('Shield absorbed the enemy attack!');
    return;
  }

  let damage = Math.min(soldiers, Math.floor(Math.random() * 15) + 5);
  soldiers -= damage;
  log(`Enemy attacked! Lost ${damage} soldiers.`);

  if (medicActive) {
    let heal = Math.min(5, 100 - soldiers);
    soldiers += heal;
    log(`Medic Tent healed ${heal} soldiers.`);
  }

  updateUI();
}

// Upgrades
function upgradeRecruit() {
  if (soldiers >= upgradeRecruitCost) {
    soldiers -= upgradeRecruitCost;
    recruitRate++;
    upgradeRecruitCost = Math.floor(upgradeRecruitCost * 1.7);
    log('Recruitment rate upgraded!');
    updateUI();
  }
}

function upgradeAttack() {
  if (soldiers >= upgradeAttackCost) {
    soldiers -= upgradeAttackCost;
    attackPower += 5;
    upgradeAttackCost = Math.floor(upgradeAttackCost * 1.8);
    log('Attack power upgraded!');
    updateUI();
  }
}

function upgradeGold() {
  if (gold >= upgradeGoldCost) {
    gold -= upgradeGoldCost;
    goldGain++;
    upgradeGoldCost = Math.floor(upgradeGoldCost * 1.5);
    log('Gold gain upgraded!');
    updateUI();
  }
}

// Buy items
function buyShield() {
  if (gold >= 50 && !shieldActive) {
    gold -= 50;
    shieldActive = true;
    log('Shield purchased and activated!');
    updateUI();
  }
}

function buyMedic() {
  if (gold >= 100 && !medicActive) {
    gold -= 100;
    medicActive = true;
    log('Medic Tent purchased! Soldiers will heal after attacks.');
    updateUI();
  }
}

// Game Loop
let lastFrameTime = 0;
function gameLoop(timestamp) {
  if (!lastFrameTime) lastFrameTime = timestamp;
  let delta = timestamp - lastFrameTime;

  // Recruitment timing
  if (timestamp - lastRecruitTime > recruitInterval) {
    recruitSoldiers();
    lastRecruitTime = timestamp;
  }

  // Enemy attack timing
  if (timestamp - lastEnemyAttackTime > enemyAttackInterval) {
    enemyAttack();
    lastEnemy
